@using Application.Extensions
@using Web.Models.Nav


<MudNavMenu>
    <MudTextField @bind-Value="_searchString" Placeholder="Buscar" Adornment="Adornment.Start" Clearable="true"
                  AdornmentIcon="@Icons.Filled.Search" IconSize="Size.Small" Class="my-0 mx-2" Immediate="true"></MudTextField>

    @foreach (var group in _navGroups)
    {
        <MudText Typo="Typo.subtitle2" Color="Color.Inherit" Class="ml-4 my-3">@group.Name</MudText>

        @foreach (var element in group.NavElements)
        {
            if (element.GetType() == typeof(NavLinkGroup))
            {
                var linkGroup = (NavLinkGroup)element;
                var canViewGroup = linkGroup.RequiredRoles.Any(r => _user.IsInRole(r) || r == string.Empty);

                if (canViewGroup)
                {
                    <MudNavGroup Title="@linkGroup.Name" Icon="@linkGroup.Icon" Expanded="_isSearching">
                        @foreach (var link in linkGroup.NavLinks)
                        {
                            if (_user.IsInRole(link.RequiredRole) || link.RequiredRole == string.Empty)
                            {
                                <MudNavLink Href="@link.Url" Icon="@link.Icon">@link.Name</MudNavLink>
                            }
                        }
                    </MudNavGroup>
                }

            }
            else
            {
                var link = (Web.Models.Nav.NavLink)element;
                if (_user.IsInRole(link.RequiredRole) || link.RequiredRole == string.Empty)
                {
                    <MudNavLink Href="@link.Url" Icon="@link.Icon">@link.Name</MudNavLink>
                }
            }
        }
    }
</MudNavMenu>
